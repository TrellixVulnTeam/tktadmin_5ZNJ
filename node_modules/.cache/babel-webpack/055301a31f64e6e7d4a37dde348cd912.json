{"ast":null,"code":"import addDays from 'date-fns/add_days';\nimport addHours from 'date-fns/add_hours';\nimport addMinutes from 'date-fns/add_minutes';\nimport addSeconds from 'date-fns/add_seconds';\nimport differenceInDays from 'date-fns/difference_in_days';\nimport differenceInMinutes from 'date-fns/difference_in_minutes';\nimport differenceInSeconds from 'date-fns/difference_in_seconds';\nimport endOfDay from 'date-fns/end_of_day';\nimport endOfMonth from 'date-fns/end_of_month';\nimport endOfWeek from 'date-fns/end_of_week';\nimport getDay from 'date-fns/get_day';\nimport isDate from 'date-fns/is_date';\nimport isSameDay from 'date-fns/is_same_day';\nimport isSameMonth from 'date-fns/is_same_month';\nimport isSameSecond from 'date-fns/is_same_second';\nimport max from 'date-fns/max';\nimport setHours from 'date-fns/set_hours';\nimport setMinutes from 'date-fns/set_minutes';\nimport startOfDay from 'date-fns/start_of_day';\nimport startOfMinute from 'date-fns/start_of_minute';\nimport startOfMonth from 'date-fns/start_of_month';\nimport startOfWeek from 'date-fns/start_of_week';\nexport var DAYS_OF_WEEK;\n\n(function (DAYS_OF_WEEK) {\n  DAYS_OF_WEEK[DAYS_OF_WEEK[\"SUNDAY\"] = 0] = \"SUNDAY\";\n  DAYS_OF_WEEK[DAYS_OF_WEEK[\"MONDAY\"] = 1] = \"MONDAY\";\n  DAYS_OF_WEEK[DAYS_OF_WEEK[\"TUESDAY\"] = 2] = \"TUESDAY\";\n  DAYS_OF_WEEK[DAYS_OF_WEEK[\"WEDNESDAY\"] = 3] = \"WEDNESDAY\";\n  DAYS_OF_WEEK[DAYS_OF_WEEK[\"THURSDAY\"] = 4] = \"THURSDAY\";\n  DAYS_OF_WEEK[DAYS_OF_WEEK[\"FRIDAY\"] = 5] = \"FRIDAY\";\n  DAYS_OF_WEEK[DAYS_OF_WEEK[\"SATURDAY\"] = 6] = \"SATURDAY\";\n})(DAYS_OF_WEEK || (DAYS_OF_WEEK = {}));\n\nvar DEFAULT_WEEKEND_DAYS = [DAYS_OF_WEEK.SUNDAY, DAYS_OF_WEEK.SATURDAY];\nvar DAYS_IN_WEEK = 7;\nvar HOURS_IN_DAY = 24;\nvar MINUTES_IN_HOUR = 60;\nexport var SECONDS_IN_DAY = 60 * 60 * 24;\nexport var SECONDS_IN_WEEK = SECONDS_IN_DAY * DAYS_IN_WEEK;\n\nfunction getExcludedSeconds(_a) {\n  var startDate = _a.startDate,\n      seconds = _a.seconds,\n      excluded = _a.excluded,\n      _b = _a.precision,\n      precision = _b === void 0 ? 'days' : _b;\n\n  if (excluded.length < 1) {\n    return 0;\n  }\n\n  var endDate = addSeconds(startDate, seconds - 1);\n  var dayStart = getDay(startDate);\n  var dayEnd = getDay(addSeconds(endDate, 0));\n  var result = 0; // Calculated in seconds\n\n  var current = startDate;\n\n  var _loop_1 = function _loop_1() {\n    var day = getDay(current);\n\n    if (excluded.some(function (excludedDay) {\n      return excludedDay === day;\n    })) {\n      result += calculateExcludedSeconds({\n        dayStart: dayStart,\n        dayEnd: dayEnd,\n        day: day,\n        precision: precision,\n        startDate: startDate,\n        endDate: endDate\n      });\n    }\n\n    current = addDays(current, 1);\n  };\n\n  while (current < endDate) {\n    _loop_1();\n  }\n\n  return result;\n}\n\nfunction calculateExcludedSeconds(_a) {\n  var precision = _a.precision,\n      day = _a.day,\n      dayStart = _a.dayStart,\n      dayEnd = _a.dayEnd,\n      startDate = _a.startDate,\n      endDate = _a.endDate;\n\n  if (precision === 'minutes') {\n    if (day === dayStart) {\n      return differenceInSeconds(endOfDay(startDate), startDate) + 1;\n    } else if (day === dayEnd) {\n      return differenceInSeconds(endDate, startOfDay(endDate)) + 1;\n    }\n  }\n\n  return SECONDS_IN_DAY;\n}\n\nfunction getWeekViewEventSpan(_a) {\n  var event = _a.event,\n      offset = _a.offset,\n      startOfWeekDate = _a.startOfWeekDate,\n      excluded = _a.excluded,\n      _b = _a.precision,\n      precision = _b === void 0 ? 'days' : _b;\n  var span = SECONDS_IN_DAY;\n  var begin = max(event.start, startOfWeekDate);\n\n  if (event.end) {\n    switch (precision) {\n      case 'minutes':\n        span = differenceInSeconds(event.end, begin);\n        break;\n\n      default:\n        span = differenceInDays(addDays(endOfDay(event.end), 1), begin) * SECONDS_IN_DAY;\n        break;\n    }\n  }\n\n  var offsetSeconds = offset * SECONDS_IN_DAY;\n  var totalLength = offsetSeconds + span; // the best way to detect if an event is outside the week-view\n  // is to check if the total span beginning (from startOfWeekDay or event start) exceeds 7days\n\n  if (totalLength > SECONDS_IN_WEEK) {\n    span = SECONDS_IN_WEEK - offsetSeconds;\n  }\n\n  span -= getExcludedSeconds({\n    startDate: begin,\n    seconds: span,\n    excluded: excluded,\n    precision: precision\n  });\n  return span / SECONDS_IN_DAY;\n}\n\nexport function getWeekViewEventOffset(_a) {\n  var event = _a.event,\n      startOfWeekDate = _a.startOfWeek,\n      _b = _a.excluded,\n      excluded = _b === void 0 ? [] : _b,\n      _c = _a.precision,\n      precision = _c === void 0 ? 'days' : _c;\n\n  if (event.start < startOfWeekDate) {\n    return 0;\n  }\n\n  var offset = 0;\n\n  switch (precision) {\n    case 'days':\n      offset = differenceInDays(startOfDay(event.start), startOfWeekDate) * SECONDS_IN_DAY;\n      break;\n\n    case 'minutes':\n      offset = differenceInSeconds(event.start, startOfWeekDate);\n      break;\n  }\n\n  offset -= getExcludedSeconds({\n    startDate: startOfWeekDate,\n    seconds: offset,\n    excluded: excluded,\n    precision: precision\n  });\n  return offset / SECONDS_IN_DAY;\n}\n\nfunction isEventIsPeriod(_a) {\n  var event = _a.event,\n      periodStart = _a.periodStart,\n      periodEnd = _a.periodEnd;\n  var eventStart = event.start;\n  var eventEnd = event.end || event.start;\n\n  if (eventStart > periodStart && eventStart < periodEnd) {\n    return true;\n  }\n\n  if (eventEnd > periodStart && eventEnd < periodEnd) {\n    return true;\n  }\n\n  if (eventStart < periodStart && eventEnd > periodEnd) {\n    return true;\n  }\n\n  if (isSameSecond(eventStart, periodStart) || isSameSecond(eventStart, periodEnd)) {\n    return true;\n  }\n\n  if (isSameSecond(eventEnd, periodStart) || isSameSecond(eventEnd, periodEnd)) {\n    return true;\n  }\n\n  return false;\n}\n\nexport function getEventsInPeriod(_a) {\n  var events = _a.events,\n      periodStart = _a.periodStart,\n      periodEnd = _a.periodEnd;\n  return events.filter(function (event) {\n    return isEventIsPeriod({\n      event: event,\n      periodStart: periodStart,\n      periodEnd: periodEnd\n    });\n  });\n}\n\nfunction getWeekDay(_a) {\n  var date = _a.date,\n      _b = _a.weekendDays,\n      weekendDays = _b === void 0 ? DEFAULT_WEEKEND_DAYS : _b;\n  var today = startOfDay(new Date());\n  return {\n    date: date,\n    isPast: date < today,\n    isToday: isSameDay(date, today),\n    isFuture: date > today,\n    isWeekend: weekendDays.indexOf(getDay(date)) > -1\n  };\n}\n\nexport function getWeekViewHeader(_a) {\n  var viewDate = _a.viewDate,\n      weekStartsOn = _a.weekStartsOn,\n      _b = _a.excluded,\n      excluded = _b === void 0 ? [] : _b,\n      weekendDays = _a.weekendDays;\n  var start = startOfWeek(viewDate, {\n    weekStartsOn: weekStartsOn\n  });\n  var days = [];\n\n  var _loop_2 = function _loop_2(i) {\n    var date = addDays(start, i);\n\n    if (!excluded.some(function (e) {\n      return date.getDay() === e;\n    })) {\n      days.push(getWeekDay({\n        date: date,\n        weekendDays: weekendDays\n      }));\n    }\n  };\n\n  for (var i = 0; i < DAYS_IN_WEEK; i++) {\n    _loop_2(i);\n  }\n\n  return days;\n}\nexport function getWeekView(_a) {\n  var _b = _a.events,\n      events = _b === void 0 ? [] : _b,\n      viewDate = _a.viewDate,\n      weekStartsOn = _a.weekStartsOn,\n      _c = _a.excluded,\n      excluded = _c === void 0 ? [] : _c,\n      _d = _a.precision,\n      precision = _d === void 0 ? 'days' : _d,\n      _e = _a.absolutePositionedEvents,\n      absolutePositionedEvents = _e === void 0 ? false : _e;\n\n  if (!events) {\n    events = [];\n  }\n\n  var startOfViewWeek = startOfWeek(viewDate, {\n    weekStartsOn: weekStartsOn\n  });\n  var endOfViewWeek = endOfWeek(viewDate, {\n    weekStartsOn: weekStartsOn\n  });\n  var maxRange = DAYS_IN_WEEK - excluded.length;\n  var eventsInPeriod = getEventsInPeriod({\n    events: events,\n    periodStart: startOfViewWeek,\n    periodEnd: endOfViewWeek\n  });\n  var eventsMapped = eventsInPeriod.map(function (event) {\n    var offset = getWeekViewEventOffset({\n      event: event,\n      startOfWeek: startOfViewWeek,\n      excluded: excluded,\n      precision: precision\n    });\n    var span = getWeekViewEventSpan({\n      event: event,\n      offset: offset,\n      startOfWeekDate: startOfViewWeek,\n      excluded: excluded,\n      precision: precision\n    });\n    return {\n      event: event,\n      offset: offset,\n      span: span\n    };\n  }).filter(function (e) {\n    return e.offset < maxRange;\n  }).filter(function (e) {\n    return e.span > 0;\n  }).map(function (entry) {\n    return {\n      event: entry.event,\n      offset: entry.offset,\n      span: entry.span,\n      startsBeforeWeek: entry.event.start < startOfViewWeek,\n      endsAfterWeek: (entry.event.end || entry.event.start) > endOfViewWeek\n    };\n  }).sort(function (itemA, itemB) {\n    var startSecondsDiff = differenceInSeconds(itemA.event.start, itemB.event.start);\n\n    if (startSecondsDiff === 0) {\n      return differenceInSeconds(itemB.event.end || itemB.event.start, itemA.event.end || itemA.event.start);\n    }\n\n    return startSecondsDiff;\n  });\n  var eventRows = [];\n  var allocatedEvents = [];\n  eventsMapped.forEach(function (event, index) {\n    if (allocatedEvents.indexOf(event) === -1) {\n      allocatedEvents.push(event);\n      var rowSpan_1 = event.span + event.offset;\n      var otherRowEvents = eventsMapped.slice(index + 1).filter(function (nextEvent) {\n        if (nextEvent.offset >= rowSpan_1 && rowSpan_1 + nextEvent.span <= DAYS_IN_WEEK && allocatedEvents.indexOf(nextEvent) === -1) {\n          var nextEventOffset = nextEvent.offset - rowSpan_1;\n\n          if (!absolutePositionedEvents) {\n            nextEvent.offset = nextEventOffset;\n          }\n\n          rowSpan_1 += nextEvent.span + nextEventOffset;\n          allocatedEvents.push(nextEvent);\n          return true;\n        }\n      });\n      eventRows.push({\n        row: [event].concat(otherRowEvents)\n      });\n    }\n  });\n  return {\n    eventRows: eventRows,\n    period: {\n      events: eventsInPeriod,\n      start: startOfViewWeek,\n      end: endOfViewWeek\n    }\n  };\n}\nexport function getMonthView(_a) {\n  var _b = _a.events,\n      events = _b === void 0 ? [] : _b,\n      viewDate = _a.viewDate,\n      weekStartsOn = _a.weekStartsOn,\n      _c = _a.excluded,\n      excluded = _c === void 0 ? [] : _c,\n      _d = _a.viewStart,\n      viewStart = _d === void 0 ? startOfMonth(viewDate) : _d,\n      _e = _a.viewEnd,\n      viewEnd = _e === void 0 ? endOfMonth(viewDate) : _e,\n      weekendDays = _a.weekendDays;\n\n  if (!events) {\n    events = [];\n  }\n\n  var start = startOfWeek(viewStart, {\n    weekStartsOn: weekStartsOn\n  });\n  var end = endOfWeek(viewEnd, {\n    weekStartsOn: weekStartsOn\n  });\n  var eventsInMonth = getEventsInPeriod({\n    events: events,\n    periodStart: start,\n    periodEnd: end\n  });\n  var initialViewDays = [];\n  var previousDate;\n\n  var _loop_3 = function _loop_3(i) {\n    // hacky fix for https://github.com/mattlewis92/angular-calendar/issues/173\n    var date;\n\n    if (previousDate) {\n      date = startOfDay(addHours(previousDate, HOURS_IN_DAY));\n\n      if (previousDate.getTime() === date.getTime()) {\n        // DST change, so need to add 25 hours\n        date = startOfDay(addHours(previousDate, HOURS_IN_DAY + 1));\n      }\n\n      previousDate = date;\n    } else {\n      date = previousDate = start;\n    }\n\n    if (!excluded.some(function (e) {\n      return date.getDay() === e;\n    })) {\n      var day = getWeekDay({\n        date: date,\n        weekendDays: weekendDays\n      });\n      var eventsInPeriod = getEventsInPeriod({\n        events: eventsInMonth,\n        periodStart: startOfDay(date),\n        periodEnd: endOfDay(date)\n      });\n      day.inMonth = isSameMonth(date, viewDate);\n      day.events = eventsInPeriod;\n      day.badgeTotal = eventsInPeriod.length;\n      initialViewDays.push(day);\n    }\n  };\n\n  for (var i = 0; i < differenceInDays(end, start) + 1; i++) {\n    _loop_3(i);\n  }\n\n  var days = [];\n  var totalDaysVisibleInWeek = DAYS_IN_WEEK - excluded.length;\n\n  if (totalDaysVisibleInWeek < DAYS_IN_WEEK) {\n    for (var i = 0; i < initialViewDays.length; i += totalDaysVisibleInWeek) {\n      var row = initialViewDays.slice(i, i + totalDaysVisibleInWeek);\n      var isRowInMonth = row.some(function (day) {\n        return day.date.getMonth() === viewDate.getMonth();\n      });\n\n      if (isRowInMonth) {\n        days = days.concat(row);\n      }\n    }\n  } else {\n    days = initialViewDays;\n  }\n\n  var rows = Math.floor(days.length / totalDaysVisibleInWeek);\n  var rowOffsets = [];\n\n  for (var i = 0; i < rows; i++) {\n    rowOffsets.push(i * totalDaysVisibleInWeek);\n  }\n\n  return {\n    rowOffsets: rowOffsets,\n    totalDaysVisibleInWeek: totalDaysVisibleInWeek,\n    days: days,\n    period: {\n      start: start,\n      end: end,\n      events: eventsInMonth\n    }\n  };\n}\nexport function getDayView(_a) {\n  var _b = _a.events,\n      events = _b === void 0 ? [] : _b,\n      viewDate = _a.viewDate,\n      hourSegments = _a.hourSegments,\n      dayStart = _a.dayStart,\n      dayEnd = _a.dayEnd,\n      eventWidth = _a.eventWidth,\n      segmentHeight = _a.segmentHeight;\n\n  if (!events) {\n    events = [];\n  }\n\n  var startOfView = setMinutes(setHours(startOfDay(viewDate), dayStart.hour), dayStart.minute);\n  var endOfView = setMinutes(setHours(startOfMinute(endOfDay(viewDate)), dayEnd.hour), dayEnd.minute);\n  var previousDayEvents = [];\n  var eventsInPeriod = getEventsInPeriod({\n    events: events.filter(function (event) {\n      return !event.allDay;\n    }),\n    periodStart: startOfView,\n    periodEnd: endOfView\n  });\n  var dayViewEvents = eventsInPeriod.sort(function (eventA, eventB) {\n    return eventA.start.valueOf() - eventB.start.valueOf();\n  }).map(function (event) {\n    var eventStart = event.start;\n    var eventEnd = event.end || eventStart;\n    var startsBeforeDay = eventStart < startOfView;\n    var endsAfterDay = eventEnd > endOfView;\n    var hourHeightModifier = hourSegments * segmentHeight / MINUTES_IN_HOUR;\n    var top = 0;\n\n    if (eventStart > startOfView) {\n      top += differenceInMinutes(eventStart, startOfView);\n    }\n\n    top *= hourHeightModifier;\n    var startDate = startsBeforeDay ? startOfView : eventStart;\n    var endDate = endsAfterDay ? endOfView : eventEnd;\n    var height = differenceInMinutes(endDate, startDate);\n\n    if (!event.end) {\n      height = segmentHeight;\n    } else {\n      height *= hourHeightModifier;\n    }\n\n    var bottom = top + height;\n    var overlappingPreviousEvents = previousDayEvents.filter(function (previousEvent) {\n      var previousEventTop = previousEvent.top;\n      var previousEventBottom = previousEvent.top + previousEvent.height;\n\n      if (top < previousEventBottom && previousEventBottom < bottom) {\n        return true;\n      } else if (previousEventTop <= top && bottom <= previousEventBottom) {\n        return true;\n      }\n\n      return false;\n    });\n    var left = 0;\n\n    while (overlappingPreviousEvents.some(function (previousEvent) {\n      return previousEvent.left === left;\n    })) {\n      left += eventWidth;\n    }\n\n    var dayEvent = {\n      event: event,\n      height: height,\n      width: eventWidth,\n      top: top,\n      left: left,\n      startsBeforeDay: startsBeforeDay,\n      endsAfterDay: endsAfterDay\n    };\n\n    if (height > 0) {\n      previousDayEvents.push(dayEvent);\n    }\n\n    return dayEvent;\n  }).filter(function (dayEvent) {\n    return dayEvent.height > 0;\n  });\n  var width = Math.max.apply(Math, dayViewEvents.map(function (event) {\n    return event.left + event.width;\n  }));\n  var allDayEvents = getEventsInPeriod({\n    events: events.filter(function (event) {\n      return event.allDay;\n    }),\n    periodStart: startOfDay(startOfView),\n    periodEnd: endOfDay(endOfView)\n  });\n  return {\n    events: dayViewEvents,\n    width: width,\n    allDayEvents: allDayEvents,\n    period: {\n      events: eventsInPeriod,\n      start: startOfView,\n      end: endOfView\n    }\n  };\n}\nexport function getDayViewHourGrid(_a) {\n  var viewDate = _a.viewDate,\n      hourSegments = _a.hourSegments,\n      dayStart = _a.dayStart,\n      dayEnd = _a.dayEnd;\n  var hours = [];\n  var startOfView = setMinutes(setHours(startOfDay(viewDate), dayStart.hour), dayStart.minute);\n  var endOfView = setMinutes(setHours(startOfMinute(endOfDay(viewDate)), dayEnd.hour), dayEnd.minute);\n  var segmentDuration = MINUTES_IN_HOUR / hourSegments;\n  var startOfViewDay = startOfDay(viewDate);\n\n  for (var i = 0; i < HOURS_IN_DAY; i++) {\n    var segments = [];\n\n    for (var j = 0; j < hourSegments; j++) {\n      var date = addMinutes(addHours(startOfViewDay, i), j * segmentDuration);\n\n      if (date >= startOfView && date < endOfView) {\n        segments.push({\n          date: date,\n          isStart: j === 0\n        });\n      }\n    }\n\n    if (segments.length > 0) {\n      hours.push({\n        segments: segments\n      });\n    }\n  }\n\n  return hours;\n}\nexport var EventValidationErrorMessage;\n\n(function (EventValidationErrorMessage) {\n  EventValidationErrorMessage[\"NotArray\"] = \"Events must be an array\";\n  EventValidationErrorMessage[\"StartPropertyMissing\"] = \"Event is missing the `start` property\";\n  EventValidationErrorMessage[\"StartPropertyNotDate\"] = \"Event `start` property should be a javascript date object. Do `new Date(event.start)` to fix it.\";\n  EventValidationErrorMessage[\"EndPropertyNotDate\"] = \"Event `end` property should be a javascript date object. Do `new Date(event.end)` to fix it.\";\n  EventValidationErrorMessage[\"EndsBeforeStart\"] = \"Event `start` property occurs after the `end`\";\n})(EventValidationErrorMessage || (EventValidationErrorMessage = {}));\n\nexport function validateEvents(events, log) {\n  var isValid = true;\n\n  function isError(msg, event) {\n    log(msg, event);\n    isValid = false;\n  }\n\n  if (!Array.isArray(events)) {\n    log(EventValidationErrorMessage.NotArray, events);\n    return false;\n  }\n\n  events.forEach(function (event) {\n    if (!event.start) {\n      isError(EventValidationErrorMessage.StartPropertyMissing, event);\n    } else if (!isDate(event.start)) {\n      isError(EventValidationErrorMessage.StartPropertyNotDate, event);\n    }\n\n    if (event.end) {\n      if (!isDate(event.end)) {\n        isError(EventValidationErrorMessage.EndPropertyNotDate, event);\n      }\n\n      if (event.start > event.end) {\n        isError(EventValidationErrorMessage.EndsBeforeStart, event);\n      }\n    }\n  });\n  return isValid;\n}","map":{"version":3,"sources":["../src/calendar-utils.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import addDays from 'date-fns/add_days';\nimport addHours from 'date-fns/add_hours';\nimport addMinutes from 'date-fns/add_minutes';\nimport addSeconds from 'date-fns/add_seconds';\nimport differenceInDays from 'date-fns/difference_in_days';\nimport differenceInMinutes from 'date-fns/difference_in_minutes';\nimport differenceInSeconds from 'date-fns/difference_in_seconds';\nimport endOfDay from 'date-fns/end_of_day';\nimport endOfMonth from 'date-fns/end_of_month';\nimport endOfWeek from 'date-fns/end_of_week';\nimport getDay from 'date-fns/get_day';\nimport isDate from 'date-fns/is_date';\nimport isSameDay from 'date-fns/is_same_day';\nimport isSameMonth from 'date-fns/is_same_month';\nimport isSameSecond from 'date-fns/is_same_second';\nimport max from 'date-fns/max';\nimport setHours from 'date-fns/set_hours';\nimport setMinutes from 'date-fns/set_minutes';\nimport startOfDay from 'date-fns/start_of_day';\nimport startOfMinute from 'date-fns/start_of_minute';\nimport startOfMonth from 'date-fns/start_of_month';\nimport startOfWeek from 'date-fns/start_of_week';\nexport var DAYS_OF_WEEK;\n(function (DAYS_OF_WEEK) {\n    DAYS_OF_WEEK[DAYS_OF_WEEK[\"SUNDAY\"] = 0] = \"SUNDAY\";\n    DAYS_OF_WEEK[DAYS_OF_WEEK[\"MONDAY\"] = 1] = \"MONDAY\";\n    DAYS_OF_WEEK[DAYS_OF_WEEK[\"TUESDAY\"] = 2] = \"TUESDAY\";\n    DAYS_OF_WEEK[DAYS_OF_WEEK[\"WEDNESDAY\"] = 3] = \"WEDNESDAY\";\n    DAYS_OF_WEEK[DAYS_OF_WEEK[\"THURSDAY\"] = 4] = \"THURSDAY\";\n    DAYS_OF_WEEK[DAYS_OF_WEEK[\"FRIDAY\"] = 5] = \"FRIDAY\";\n    DAYS_OF_WEEK[DAYS_OF_WEEK[\"SATURDAY\"] = 6] = \"SATURDAY\";\n})(DAYS_OF_WEEK || (DAYS_OF_WEEK = {}));\nvar DEFAULT_WEEKEND_DAYS = [\n    DAYS_OF_WEEK.SUNDAY,\n    DAYS_OF_WEEK.SATURDAY\n];\nvar DAYS_IN_WEEK = 7;\nvar HOURS_IN_DAY = 24;\nvar MINUTES_IN_HOUR = 60;\nexport var SECONDS_IN_DAY = 60 * 60 * 24;\nexport var SECONDS_IN_WEEK = SECONDS_IN_DAY * DAYS_IN_WEEK;\nfunction getExcludedSeconds(_a) {\n    var startDate = _a.startDate, seconds = _a.seconds, excluded = _a.excluded, _b = _a.precision, precision = _b === void 0 ? 'days' : _b;\n    if (excluded.length < 1) {\n        return 0;\n    }\n    var endDate = addSeconds(startDate, seconds - 1);\n    var dayStart = getDay(startDate);\n    var dayEnd = getDay(addSeconds(endDate, 0));\n    var result = 0; // Calculated in seconds\n    var current = startDate;\n    var _loop_1 = function () {\n        var day = getDay(current);\n        if (excluded.some(function (excludedDay) { return excludedDay === day; })) {\n            result += calculateExcludedSeconds({\n                dayStart: dayStart,\n                dayEnd: dayEnd,\n                day: day,\n                precision: precision,\n                startDate: startDate,\n                endDate: endDate\n            });\n        }\n        current = addDays(current, 1);\n    };\n    while (current < endDate) {\n        _loop_1();\n    }\n    return result;\n}\nfunction calculateExcludedSeconds(_a) {\n    var precision = _a.precision, day = _a.day, dayStart = _a.dayStart, dayEnd = _a.dayEnd, startDate = _a.startDate, endDate = _a.endDate;\n    if (precision === 'minutes') {\n        if (day === dayStart) {\n            return differenceInSeconds(endOfDay(startDate), startDate) + 1;\n        }\n        else if (day === dayEnd) {\n            return differenceInSeconds(endDate, startOfDay(endDate)) + 1;\n        }\n    }\n    return SECONDS_IN_DAY;\n}\nfunction getWeekViewEventSpan(_a) {\n    var event = _a.event, offset = _a.offset, startOfWeekDate = _a.startOfWeekDate, excluded = _a.excluded, _b = _a.precision, precision = _b === void 0 ? 'days' : _b;\n    var span = SECONDS_IN_DAY;\n    var begin = max(event.start, startOfWeekDate);\n    if (event.end) {\n        switch (precision) {\n            case 'minutes':\n                span = differenceInSeconds(event.end, begin);\n                break;\n            default:\n                span =\n                    differenceInDays(addDays(endOfDay(event.end), 1), begin) *\n                        SECONDS_IN_DAY;\n                break;\n        }\n    }\n    var offsetSeconds = offset * SECONDS_IN_DAY;\n    var totalLength = offsetSeconds + span;\n    // the best way to detect if an event is outside the week-view\n    // is to check if the total span beginning (from startOfWeekDay or event start) exceeds 7days\n    if (totalLength > SECONDS_IN_WEEK) {\n        span = SECONDS_IN_WEEK - offsetSeconds;\n    }\n    span -= getExcludedSeconds({\n        startDate: begin,\n        seconds: span,\n        excluded: excluded,\n        precision: precision\n    });\n    return span / SECONDS_IN_DAY;\n}\nexport function getWeekViewEventOffset(_a) {\n    var event = _a.event, startOfWeekDate = _a.startOfWeek, _b = _a.excluded, excluded = _b === void 0 ? [] : _b, _c = _a.precision, precision = _c === void 0 ? 'days' : _c;\n    if (event.start < startOfWeekDate) {\n        return 0;\n    }\n    var offset = 0;\n    switch (precision) {\n        case 'days':\n            offset =\n                differenceInDays(startOfDay(event.start), startOfWeekDate) *\n                    SECONDS_IN_DAY;\n            break;\n        case 'minutes':\n            offset = differenceInSeconds(event.start, startOfWeekDate);\n            break;\n    }\n    offset -= getExcludedSeconds({\n        startDate: startOfWeekDate,\n        seconds: offset,\n        excluded: excluded,\n        precision: precision\n    });\n    return offset / SECONDS_IN_DAY;\n}\nfunction isEventIsPeriod(_a) {\n    var event = _a.event, periodStart = _a.periodStart, periodEnd = _a.periodEnd;\n    var eventStart = event.start;\n    var eventEnd = event.end || event.start;\n    if (eventStart > periodStart && eventStart < periodEnd) {\n        return true;\n    }\n    if (eventEnd > periodStart && eventEnd < periodEnd) {\n        return true;\n    }\n    if (eventStart < periodStart && eventEnd > periodEnd) {\n        return true;\n    }\n    if (isSameSecond(eventStart, periodStart) ||\n        isSameSecond(eventStart, periodEnd)) {\n        return true;\n    }\n    if (isSameSecond(eventEnd, periodStart) ||\n        isSameSecond(eventEnd, periodEnd)) {\n        return true;\n    }\n    return false;\n}\nexport function getEventsInPeriod(_a) {\n    var events = _a.events, periodStart = _a.periodStart, periodEnd = _a.periodEnd;\n    return events.filter(function (event) {\n        return isEventIsPeriod({ event: event, periodStart: periodStart, periodEnd: periodEnd });\n    });\n}\nfunction getWeekDay(_a) {\n    var date = _a.date, _b = _a.weekendDays, weekendDays = _b === void 0 ? DEFAULT_WEEKEND_DAYS : _b;\n    var today = startOfDay(new Date());\n    return {\n        date: date,\n        isPast: date < today,\n        isToday: isSameDay(date, today),\n        isFuture: date > today,\n        isWeekend: weekendDays.indexOf(getDay(date)) > -1\n    };\n}\nexport function getWeekViewHeader(_a) {\n    var viewDate = _a.viewDate, weekStartsOn = _a.weekStartsOn, _b = _a.excluded, excluded = _b === void 0 ? [] : _b, weekendDays = _a.weekendDays;\n    var start = startOfWeek(viewDate, { weekStartsOn: weekStartsOn });\n    var days = [];\n    var _loop_2 = function (i) {\n        var date = addDays(start, i);\n        if (!excluded.some(function (e) { return date.getDay() === e; })) {\n            days.push(getWeekDay({ date: date, weekendDays: weekendDays }));\n        }\n    };\n    for (var i = 0; i < DAYS_IN_WEEK; i++) {\n        _loop_2(i);\n    }\n    return days;\n}\nexport function getWeekView(_a) {\n    var _b = _a.events, events = _b === void 0 ? [] : _b, viewDate = _a.viewDate, weekStartsOn = _a.weekStartsOn, _c = _a.excluded, excluded = _c === void 0 ? [] : _c, _d = _a.precision, precision = _d === void 0 ? 'days' : _d, _e = _a.absolutePositionedEvents, absolutePositionedEvents = _e === void 0 ? false : _e;\n    if (!events) {\n        events = [];\n    }\n    var startOfViewWeek = startOfWeek(viewDate, { weekStartsOn: weekStartsOn });\n    var endOfViewWeek = endOfWeek(viewDate, { weekStartsOn: weekStartsOn });\n    var maxRange = DAYS_IN_WEEK - excluded.length;\n    var eventsInPeriod = getEventsInPeriod({\n        events: events,\n        periodStart: startOfViewWeek,\n        periodEnd: endOfViewWeek\n    });\n    var eventsMapped = eventsInPeriod\n        .map(function (event) {\n        var offset = getWeekViewEventOffset({\n            event: event,\n            startOfWeek: startOfViewWeek,\n            excluded: excluded,\n            precision: precision\n        });\n        var span = getWeekViewEventSpan({\n            event: event,\n            offset: offset,\n            startOfWeekDate: startOfViewWeek,\n            excluded: excluded,\n            precision: precision\n        });\n        return { event: event, offset: offset, span: span };\n    })\n        .filter(function (e) { return e.offset < maxRange; })\n        .filter(function (e) { return e.span > 0; })\n        .map(function (entry) { return ({\n        event: entry.event,\n        offset: entry.offset,\n        span: entry.span,\n        startsBeforeWeek: entry.event.start < startOfViewWeek,\n        endsAfterWeek: (entry.event.end || entry.event.start) > endOfViewWeek\n    }); })\n        .sort(function (itemA, itemB) {\n        var startSecondsDiff = differenceInSeconds(itemA.event.start, itemB.event.start);\n        if (startSecondsDiff === 0) {\n            return differenceInSeconds(itemB.event.end || itemB.event.start, itemA.event.end || itemA.event.start);\n        }\n        return startSecondsDiff;\n    });\n    var eventRows = [];\n    var allocatedEvents = [];\n    eventsMapped.forEach(function (event, index) {\n        if (allocatedEvents.indexOf(event) === -1) {\n            allocatedEvents.push(event);\n            var rowSpan_1 = event.span + event.offset;\n            var otherRowEvents = eventsMapped\n                .slice(index + 1)\n                .filter(function (nextEvent) {\n                if (nextEvent.offset >= rowSpan_1 &&\n                    rowSpan_1 + nextEvent.span <= DAYS_IN_WEEK &&\n                    allocatedEvents.indexOf(nextEvent) === -1) {\n                    var nextEventOffset = nextEvent.offset - rowSpan_1;\n                    if (!absolutePositionedEvents) {\n                        nextEvent.offset = nextEventOffset;\n                    }\n                    rowSpan_1 += nextEvent.span + nextEventOffset;\n                    allocatedEvents.push(nextEvent);\n                    return true;\n                }\n            });\n            eventRows.push({\n                row: [event].concat(otherRowEvents)\n            });\n        }\n    });\n    return {\n        eventRows: eventRows,\n        period: {\n            events: eventsInPeriod,\n            start: startOfViewWeek,\n            end: endOfViewWeek\n        }\n    };\n}\nexport function getMonthView(_a) {\n    var _b = _a.events, events = _b === void 0 ? [] : _b, viewDate = _a.viewDate, weekStartsOn = _a.weekStartsOn, _c = _a.excluded, excluded = _c === void 0 ? [] : _c, _d = _a.viewStart, viewStart = _d === void 0 ? startOfMonth(viewDate) : _d, _e = _a.viewEnd, viewEnd = _e === void 0 ? endOfMonth(viewDate) : _e, weekendDays = _a.weekendDays;\n    if (!events) {\n        events = [];\n    }\n    var start = startOfWeek(viewStart, { weekStartsOn: weekStartsOn });\n    var end = endOfWeek(viewEnd, { weekStartsOn: weekStartsOn });\n    var eventsInMonth = getEventsInPeriod({\n        events: events,\n        periodStart: start,\n        periodEnd: end\n    });\n    var initialViewDays = [];\n    var previousDate;\n    var _loop_3 = function (i) {\n        // hacky fix for https://github.com/mattlewis92/angular-calendar/issues/173\n        var date;\n        if (previousDate) {\n            date = startOfDay(addHours(previousDate, HOURS_IN_DAY));\n            if (previousDate.getTime() === date.getTime()) {\n                // DST change, so need to add 25 hours\n                date = startOfDay(addHours(previousDate, HOURS_IN_DAY + 1));\n            }\n            previousDate = date;\n        }\n        else {\n            date = previousDate = start;\n        }\n        if (!excluded.some(function (e) { return date.getDay() === e; })) {\n            var day = getWeekDay({\n                date: date,\n                weekendDays: weekendDays\n            });\n            var eventsInPeriod = getEventsInPeriod({\n                events: eventsInMonth,\n                periodStart: startOfDay(date),\n                periodEnd: endOfDay(date)\n            });\n            day.inMonth = isSameMonth(date, viewDate);\n            day.events = eventsInPeriod;\n            day.badgeTotal = eventsInPeriod.length;\n            initialViewDays.push(day);\n        }\n    };\n    for (var i = 0; i < differenceInDays(end, start) + 1; i++) {\n        _loop_3(i);\n    }\n    var days = [];\n    var totalDaysVisibleInWeek = DAYS_IN_WEEK - excluded.length;\n    if (totalDaysVisibleInWeek < DAYS_IN_WEEK) {\n        for (var i = 0; i < initialViewDays.length; i += totalDaysVisibleInWeek) {\n            var row = initialViewDays.slice(i, i + totalDaysVisibleInWeek);\n            var isRowInMonth = row.some(function (day) { return day.date.getMonth() === viewDate.getMonth(); });\n            if (isRowInMonth) {\n                days = days.concat(row);\n            }\n        }\n    }\n    else {\n        days = initialViewDays;\n    }\n    var rows = Math.floor(days.length / totalDaysVisibleInWeek);\n    var rowOffsets = [];\n    for (var i = 0; i < rows; i++) {\n        rowOffsets.push(i * totalDaysVisibleInWeek);\n    }\n    return {\n        rowOffsets: rowOffsets,\n        totalDaysVisibleInWeek: totalDaysVisibleInWeek,\n        days: days,\n        period: {\n            start: start,\n            end: end,\n            events: eventsInMonth\n        }\n    };\n}\nexport function getDayView(_a) {\n    var _b = _a.events, events = _b === void 0 ? [] : _b, viewDate = _a.viewDate, hourSegments = _a.hourSegments, dayStart = _a.dayStart, dayEnd = _a.dayEnd, eventWidth = _a.eventWidth, segmentHeight = _a.segmentHeight;\n    if (!events) {\n        events = [];\n    }\n    var startOfView = setMinutes(setHours(startOfDay(viewDate), dayStart.hour), dayStart.minute);\n    var endOfView = setMinutes(setHours(startOfMinute(endOfDay(viewDate)), dayEnd.hour), dayEnd.minute);\n    var previousDayEvents = [];\n    var eventsInPeriod = getEventsInPeriod({\n        events: events.filter(function (event) { return !event.allDay; }),\n        periodStart: startOfView,\n        periodEnd: endOfView\n    });\n    var dayViewEvents = eventsInPeriod\n        .sort(function (eventA, eventB) {\n        return eventA.start.valueOf() - eventB.start.valueOf();\n    })\n        .map(function (event) {\n        var eventStart = event.start;\n        var eventEnd = event.end || eventStart;\n        var startsBeforeDay = eventStart < startOfView;\n        var endsAfterDay = eventEnd > endOfView;\n        var hourHeightModifier = hourSegments * segmentHeight / MINUTES_IN_HOUR;\n        var top = 0;\n        if (eventStart > startOfView) {\n            top += differenceInMinutes(eventStart, startOfView);\n        }\n        top *= hourHeightModifier;\n        var startDate = startsBeforeDay ? startOfView : eventStart;\n        var endDate = endsAfterDay ? endOfView : eventEnd;\n        var height = differenceInMinutes(endDate, startDate);\n        if (!event.end) {\n            height = segmentHeight;\n        }\n        else {\n            height *= hourHeightModifier;\n        }\n        var bottom = top + height;\n        var overlappingPreviousEvents = previousDayEvents.filter(function (previousEvent) {\n            var previousEventTop = previousEvent.top;\n            var previousEventBottom = previousEvent.top + previousEvent.height;\n            if (top < previousEventBottom && previousEventBottom < bottom) {\n                return true;\n            }\n            else if (previousEventTop <= top && bottom <= previousEventBottom) {\n                return true;\n            }\n            return false;\n        });\n        var left = 0;\n        while (overlappingPreviousEvents.some(function (previousEvent) { return previousEvent.left === left; })) {\n            left += eventWidth;\n        }\n        var dayEvent = {\n            event: event,\n            height: height,\n            width: eventWidth,\n            top: top,\n            left: left,\n            startsBeforeDay: startsBeforeDay,\n            endsAfterDay: endsAfterDay\n        };\n        if (height > 0) {\n            previousDayEvents.push(dayEvent);\n        }\n        return dayEvent;\n    })\n        .filter(function (dayEvent) { return dayEvent.height > 0; });\n    var width = Math.max.apply(Math, dayViewEvents.map(function (event) { return event.left + event.width; }));\n    var allDayEvents = getEventsInPeriod({\n        events: events.filter(function (event) { return event.allDay; }),\n        periodStart: startOfDay(startOfView),\n        periodEnd: endOfDay(endOfView)\n    });\n    return {\n        events: dayViewEvents,\n        width: width,\n        allDayEvents: allDayEvents,\n        period: {\n            events: eventsInPeriod,\n            start: startOfView,\n            end: endOfView\n        }\n    };\n}\nexport function getDayViewHourGrid(_a) {\n    var viewDate = _a.viewDate, hourSegments = _a.hourSegments, dayStart = _a.dayStart, dayEnd = _a.dayEnd;\n    var hours = [];\n    var startOfView = setMinutes(setHours(startOfDay(viewDate), dayStart.hour), dayStart.minute);\n    var endOfView = setMinutes(setHours(startOfMinute(endOfDay(viewDate)), dayEnd.hour), dayEnd.minute);\n    var segmentDuration = MINUTES_IN_HOUR / hourSegments;\n    var startOfViewDay = startOfDay(viewDate);\n    for (var i = 0; i < HOURS_IN_DAY; i++) {\n        var segments = [];\n        for (var j = 0; j < hourSegments; j++) {\n            var date = addMinutes(addHours(startOfViewDay, i), j * segmentDuration);\n            if (date >= startOfView && date < endOfView) {\n                segments.push({\n                    date: date,\n                    isStart: j === 0\n                });\n            }\n        }\n        if (segments.length > 0) {\n            hours.push({ segments: segments });\n        }\n    }\n    return hours;\n}\nexport var EventValidationErrorMessage;\n(function (EventValidationErrorMessage) {\n    EventValidationErrorMessage[\"NotArray\"] = \"Events must be an array\";\n    EventValidationErrorMessage[\"StartPropertyMissing\"] = \"Event is missing the `start` property\";\n    EventValidationErrorMessage[\"StartPropertyNotDate\"] = \"Event `start` property should be a javascript date object. Do `new Date(event.start)` to fix it.\";\n    EventValidationErrorMessage[\"EndPropertyNotDate\"] = \"Event `end` property should be a javascript date object. Do `new Date(event.end)` to fix it.\";\n    EventValidationErrorMessage[\"EndsBeforeStart\"] = \"Event `start` property occurs after the `end`\";\n})(EventValidationErrorMessage || (EventValidationErrorMessage = {}));\nexport function validateEvents(events, log) {\n    var isValid = true;\n    function isError(msg, event) {\n        log(msg, event);\n        isValid = false;\n    }\n    if (!Array.isArray(events)) {\n        log(EventValidationErrorMessage.NotArray, events);\n        return false;\n    }\n    events.forEach(function (event) {\n        if (!event.start) {\n            isError(EventValidationErrorMessage.StartPropertyMissing, event);\n        }\n        else if (!isDate(event.start)) {\n            isError(EventValidationErrorMessage.StartPropertyNotDate, event);\n        }\n        if (event.end) {\n            if (!isDate(event.end)) {\n                isError(EventValidationErrorMessage.EndPropertyNotDate, event);\n            }\n            if (event.start > event.end) {\n                isError(EventValidationErrorMessage.EndsBeforeStart, event);\n            }\n        }\n    });\n    return isValid;\n}\n//# sourceMappingURL=calendar-utils.js.map"]},"metadata":{},"sourceType":"module"}